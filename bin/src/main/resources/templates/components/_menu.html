<!-- IMPORTS -->
<div th:replace="/auth/login.html"></div>
<div th:replace="/auth/signup.html"></div>
<div th:replace="/auth/forgotPassword.html"></div>
<div th:replace="/modals/_categoryModal.html"></div>
<div th:replace="/modals/_notificationModal.html"></div>

<!-- Kiá»ƒm tra xem Ä‘Ã£ Ä‘Äƒng nháº­p chÆ°a -->
<script th:inline="javascript">
    window.isLoggedIn = /*[[${currentUser != null}]]*/ false;
</script>

<!-- Scroll to Top Button -->
<button id="scrollToTopBtn"
	class="btn btn-danger rounded-circle shadow d-flex align-items-center justify-content-center"
	title="LÃªn Ä‘áº§u trang"
	style="position: fixed; bottom: 30px; right: 20px; display: none; z-index: 9999; width: 45px; height: 45px;">
	<i class="bi bi-chevron-up fs-5"></i>
</button>

<div
	class="container-fluid app-red text-white py-2 fixed-top shadow m-0">
	<div
		class="container d-flex justify-content-between align-items-center flex-wrap">

		<!-- Logo -->
		<div class="d-flex align-items-center gap-3">
			<a href="/"
				class="d-flex align-items-center text-white text-decoration-none">
				<img th:src="@{/images/logo/logo_landscape_white.png}" alt="Logo"
				height="50" class="me-2">
			</a>

			<!-- Danh má»¥c (áº©n trÃªn mobile) -->
			<button
				class="btn btn-danger text-white d-none d-md-flex align-items-center"
				data-bs-toggle="modal" data-bs-target="#categoryModal">
				<i class="bi bi-list fs-5 me-1"></i> Danh má»¥c
			</button>

		</div>
		<!-- NÃºt menu (chá»‰ hiá»‡n trÃªn mobile) -->
		<button class="btn btn-outline-light d-md-none"
			data-bs-toggle="offcanvas" data-bs-target="#mobileMenu">
			<i class="bi bi-list fs-4"></i>
		</button>

		<!-- TÃ¬m kiáº¿m (áº©n trÃªn mobile) -->
		<form action="/search" method="get"
			class="d-md-flex d-none flex-grow-1 mx-4">
			<div class="form-control d-flex p-0 justify-content-between">
				<input type="text" name="keyword"
					class="border-0 ps-3 flex-fill rounded"
					placeholder="Báº¡n cáº§n tÃ¬m gÃ¬?">
				<button type="submit" class="btn btn-light ms-1 ">
					<i class="bi bi-search"></i>
				</button>
			</div>
		</form>

		<!-- CÃ¡c chá»©c nÄƒng (áº©n trÃªn mobile) -->
		<div
			class="d-none d-md-flex align-items-center gap-3 text-white flex-wrap justify-content-end">
			<div class="d-flex align-items-center">
				<i class="bi bi-headset fs-5 me-1"></i> <span>Hotline<br>
					<strong>1900.5301</strong></span>
			</div>
			<div class="d-flex align-items-center">
				<i class="bi bi-geo-alt fs-5 me-1"></i> <span>Há»‡ thá»‘ng<br>
					<strong>Showroom</strong></span>
			</div>
			<div class="d-flex align-items-center">
				<i class="bi bi-camera fs-5 me-1"></i> <span>Tra cá»©u<br>
					<strong>Ä‘Æ¡n hÃ ng</strong></span>
			</div>
			<a href="/cart"
				class="text-white d-flex align-items-center text-decoration-none requires-login"
				title="Giá» hÃ ng"> <i
				class="bi bi-cart3 fs-5 me-1 position-relative"> <span
					class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark"
					th:text="${cartItemCount}">0</span>
			</i> <strong>Giá» hÃ ng</strong>
			</a>


			<!-- ÄÄƒng nháº­p Dropdown -->
			<div class="dropdown">
				<button
					class="btn btn-outline-light d-flex align-items-center dropdown-toggle"
					id="loginDropdown" data-bs-toggle="dropdown" aria-expanded="false">
					<i class="bi bi-person fs-5 me-1"></i> ÄÄƒng nháº­p
				</button>
				<ul class="dropdown-menu dropdown-menu-end shadow"
					aria-labelledby="loginDropdown">

					<li class="px-3 py-2 small text-muted"
						th:if="${currentUser == null}">ğŸ‘‹ Xin chÃ o, vui lÃ²ng Ä‘Äƒng
						nháº­p</li>
					<li class="px-3 py-2 text-muted" th:if="${currentUser != null}">ğŸ‘‹
						Xin chÃ o, <strong><span th:text="${currentUser.fullName}">TÃªn
								ngÆ°á»i dÃ¹ng</span></strong>
					</li>

					<hr class="mt-0 mx-3">
					<li class="px-3 pb-2 d-flex"><a href="/account"
						class="text-black text-decoration-none requires-login"><i
							class="bi bi-person-fill me-1"></i> ThÃ´ng tin tÃ i khoáº£n</a></li>
					<li class="px-3 pb-2 d-flex"><a href="/account/order-history"
						class="text-black text-decoration-none requires-login"><i
							class="bi bi-clipboard-fill me-1"></i> ÄÆ¡n hÃ ng cá»§a tÃ´i</a></li>
					<li class="px-3 pb-2 d-flex"><a href="/admin"
						class="text-black text-decoration-none requires-login"><i
							class="bi bi-gear-fill me-1"></i> Chá»©c nÄƒng quáº£n lÃ½</a></li>
					<li class="px-3 pb-2 d-flex"><a href="#" id="logoutBtn"
						class="text-black text-decoration-none"> <i
							class="bi bi-box-arrow-right me-1"></i> ÄÄƒng xuáº¥t
					</a></li>

					<hr class="mx-3">
					<li class="px-3 pb-2 d-flex">
						<button class="btn btn-danger w-100" data-bs-toggle="modal"
							data-bs-target="#loginModal">ÄÄƒng nháº­p</button>
						<button class="btn btn-link w-100 text-dark text-decoration-none"
							data-bs-toggle="modal" data-bs-target="#registerModal">ÄÄƒng
							kÃ½</button>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>

<!-- Offcanvas Menu (Mobile) -->
<div class="offcanvas offcanvas-end w-100" tabindex="-1" id="mobileMenu">
	<div class="offcanvas-header">
		<h5 class="offcanvas-title">Menu</h5>
		<button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
	</div>
	<div class="offcanvas-body">
		<form action="/search" method="get" class="mb-3">
			<div class="input-group">
				<input type="text" class="form-control" name="keyword"
					placeholder="Báº¡n cáº§n tÃ¬m gÃ¬?">
				<button class="btn btn-outline-secondary" type="submit">
					<i class="bi bi-search"></i>
				</button>
			</div>
		</form>
		<ul class="list-unstyled">
			<li class="mb-2"><i class="bi bi-headset me-2"></i> Hotline: <strong>1900.5301</strong></li>
			<li class="mb-2"><i class="bi bi-geo-alt me-2"></i> Há»‡ thá»‘ng
				Showroom</li>
			<li class="mb-2"><i class="bi bi-camera me-2"></i> Tra cá»©u Ä‘Æ¡n
				hÃ ng</li>
			<li class="mb-2"><a href="/cart" class="text-decoration-none"><i
					class="bi bi-cart3 me-2"></i> Giá» hÃ ng</a></li>
			<li class="mb-2"><a href="/order" class="text-decoration-none"><i
					class="bi bi-clipboard-fill me-2"></i> ÄÆ¡n hÃ ng cá»§a tÃ´i</a></li>
			<li class="mb-2"><a href="/admin" class="text-decoration-none"><i
					class="bi bi-gear-fill me-2"></i> Chá»©c nÄƒng quáº£n lÃ½</a></li>
			<li class="mb-2"><a href="#" id="logoutBtnMobile"
				class="text-decoration-none"> <i
					class="bi bi-box-arrow-right me-2"></i> ÄÄƒng xuáº¥t
			</a></li>

			<li class="mt-3 d-flex">
				<button class="btn btn-danger w-100 m-0" data-bs-toggle="modal"
					data-bs-target="#loginModal">ÄÄƒng nháº­p</button>
				<button class="btn btn-outline-dark w-100 m-0"
					data-bs-toggle="modal" data-bs-target="#registerModal">ÄÄƒng
					kÃ½</button>
			</li>
		</ul>
	</div>
</div>

<script>
	const scrollToTopBtn = document.getElementById("scrollToTopBtn"); //kÃ©o lÃªn Ä‘áº§u trang

	window.addEventListener("scroll", function() {
		if (window.scrollY > 200) {
			scrollToTopBtn.style.display = "block";
		} else {
			scrollToTopBtn.style.display = "none";
		}
	});

	scrollToTopBtn.addEventListener("click", function() {
		window.scrollTo({
			top : 0,
			behavior : "smooth"
		});
	});
	
	//má»Ÿ modal Ä‘Äƒng nháº­p khi nháº¥p vÃ o Ä‘Æ°á»ng dáº«n yÃªu cáº§u Ä‘Äƒng nháº­p
	document.addEventListener('DOMContentLoaded', function () {
    if (!window.isLoggedIn) {
        document.querySelectorAll('a.requires-login').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
            });
        });
    }
});

	
	//logout:
	document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('#logoutBtn, #logoutBtnMobile').forEach(btn => {
        btn.addEventListener('click', function (e) {
            e.preventDefault();

            fetch('/logout', {
                method: 'POST',
                credentials: 'include'
            })
            .then(res => {
    if (res.ok) {
        showCustomMessage({
            title: 'ÄÄƒng xuáº¥t',
            message: 'Báº¡n Ä‘Ã£ Ä‘Äƒng xuáº¥t thÃ nh cÃ´ng!',
            type: 'success'
        });

        // ğŸ” Äá»£i 2 giÃ¢y rá»“i reload (Ä‘á»ƒ user ká»‹p nhÃ¬n tháº¥y modal)
        setTimeout(() => {
            location.href = "/";
        }, 2000);
    } else {
        showCustomMessage({
            title: 'Lá»—i',
            message: 'ÄÄƒng xuáº¥t tháº¥t báº¡i',
            type: 'error'
        });
    }
})
            .catch(() => {
                showCustomMessage({
                    title: 'Lá»—i',
                    message: 'KhÃ´ng thá»ƒ káº¿t ná»‘i mÃ¡y chá»§',
                    type: 'error'
                });
            });
        });
    });
});


</script>


<style>
.dropdown-menu {
	min-width: 250px;
	border-radius: 8px;
}

.dropdown-menu button.btn-link:hover {
	text-decoration: underline;
	color: #e30019 !important;
}

.dropdown-menu button {
	transition: all 0.2s ease-in-out;
}

#scrollToTopBtn {
	transition: transform 0.2s ease-in-out;
}

#scrollToTopBtn:hover {
	transform: scale(1.1);
}
</style>
